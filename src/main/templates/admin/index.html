{% extends 'base.html' %}

{% block title %}
{{ g.user['username'] }}-ÎÇ¥ Ï†ïÎ≥¥
{% endblock title %}

{% block extra_head_style %}
<!-- echart js & axios -->
<!--suppress BadExpressionStatementJS -->
<script src="{{url_for('static', filename='js/admin/echarts.min.js')}}"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
{% endblock extra_head_style %}

{% block hero %}{% endblock hero %}

<!--base.htmlÏóêÏÑú <block main > ÎÇ¥Î∂Ä <div class="box is-marginless is-shadowless is-radiusless"> Î∞îÎ°ú ÏïÑÎûò
div.box ÏïàÏ™ΩÏúºÎ°ú  block box /endblockÏùÑ Ï∂îÍ∞ÄÌïúÎã§-->

{% block box %}
<div class="columns ">
    <!-- adminÏùò ÏôºÏ™ΩÎ©îÎâ¥ column 2Ïπ∏ -->
    <div class="column is-2">
        <div class="card is-shadowless" style="border-right:solid 1px #eee">
            <div class="card-content">
                <!--  asideÏôºÏ™ΩÎ©îÎâ¥Î•º Ï±ÑÏö∞Îäî block( ÏûêÏãùÏ§ëÏóê ÎÇòÎ•º ÏÉÅÏÜçÌï¥ÏÑú Îã§Î•¥Í≤å Ï±ÑÏö∏ Ïàò ÏûàÎäî block -->
                {% block menus %}
                <aside class="menu">
                    {{request.path}}
                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-google-assistant"></i></span>
                        Dashboard |
                    </p>
                    <ul class="menu-list">
                        <li>
                            <a class="{% if request.path == '/admin/' %}is-active{% endif %}"
                               href="{{ url_for('admin.index') }}">
                                <span class="icon"><i class="mdi mdi-home-variant-outline"></i></span>
                                Content ÌÜµÍ≥Ñ
                            </a>
                        </li>
                        <li>
<!--                            <a class="{% if request.path == '/admin/' %}is-active{% endif %}"-->
                            <a class=""
                               href="{{ url_for('admin.index') }}">
                                <span class="icon"><i class="mdi mdi-flask-empty-plus"></i></span>
                                ÏßÅÏõê ÌÜµÍ≥Ñ
                            </a>
                        </li>
                    </ul>

                    <!-- Category for executive -->
                    {% if g.user.is_executive %}
                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-shape-outline"></i></span>
                        MENU
                    </p>
                    <ul class="menu-list">
                        <!-- Í∞Å entityÎ≥Ñ select route/tempalteÏôÑÏÑ±Ïãú ÎßàÎã§ Í±∏Ïñ¥Ï£ºÍ∏∞ -->
                        <li>
                            <a class="{% if 'category' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.category') }}">
                                <span class="icon"><i class="mdi mdi-menu"></i></span>
                                Î©îÎâ¥Í¥ÄÎ¶¨
                            </a>
                        </li>
                    </ul>
                    {% endif %}


                    <!-- Article (post, tag) -->
                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-clipboard-text-multiple-outline"></i></span>
                        Article
                    </p>
                    <ul class="menu-list">
                        <!-- Í∞Å entityÎ≥Ñ select route/tempalteÏôÑÏÑ±Ïãú ÎßàÎã§ Í±∏Ïñ¥Ï£ºÍ∏∞ -->
                        <li>
                            <a class="{% if 'category' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.category') }}">
                                <span class="icon"><i class="mdi mdi-menu"></i></span>
                                Category Í¥ÄÎ¶¨
                            </a>
                        </li>
                        <li>
                            <a class="{% if 'article' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.article') }}">
                                <span class="icon"><i class="mdi mdi-clipboard-text-outline"></i></span>
                                Post Í¥ÄÎ¶¨
                            </a>
                        </li>
                        <li>
                            <a class="{% if 'tag' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.tag') }}">
                                <span class="icon"><i class="mdi mdi-tag-plus-outline"></i></span>
                                Tag Í¥ÄÎ¶¨
                            </a>
                        </li>

                        <li>
                            <a class="{% if 'banner' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.banner') }}">
                                <span class="icon"><i class="mdi mdi-image-sync-outline"></i></span>
                                Banner Í¥ÄÎ¶¨
                            </a>
                        </li>

                    </ul>

                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-image-outline"></i></span>
                        BANNER
                    </p>
                    <ul class="menu-list">
                    </ul>

                    <!-- USER -->
                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-account-group-outline"></i></span>
                        User
                    </p>
                    <ul class="menu-list">
                        <li>
                            <a class="{% if 'user' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.user') }}">
                                <span class="icon"><i class="mdi mdi-account-outline"></i></span>
                                User Í¥ÄÎ¶¨
                            </a>
                        </li>
                        <!-- ÏßÅÏõê Í¥ÄÎ¶¨ for chiefstaff -->
                        {% if g.user.is_chiefstaff %}
                        <li>
                            <a class="{% if 'employee' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.employee') }}">
                                <!--                                <span class="icon"><i class="mdi mdi-lock-outline"></i></span>-->
                                <span class="icon"><i class="mdi mdi-account-group-outline"></i></span>
                                ÏßÅÏõê Í¥ÄÎ¶¨
                            </a>
                        </li>
                        {% endif %}
                    </ul>


                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-graph-outline"></i></span>
                        DEPARTMENT
                    </p>
                    <ul class="menu-list">
                        <!-- Ï°∞ÏßÅÎèÑ for all -->
                        <li>
                            <a class="{% if 'organization' in request.path %}is-active{% endif %}"
                               href="{{ url_for('department.organization') }}">
                                <span class="icon"><i class="mdi mdi-graph-outline"></i></span>
                                Ï°∞ÏßÅÎèÑ
                            </a>
                        </li>
                        <!-- Î∂ÄÏÑúÍ¥ÄÎ¶¨ for executive -->
                        {% if g.user.is_executive %}
                        <li>
                            <a class="{% if 'departments' in request.path %}is-active{% endif %}"
                               href="{{ url_for('department.management') }}">
                                <span class="icon"><i class="mdi mdi-lock-outline"></i></span>
                                Î∂ÄÏÑú Í¥ÄÎ¶¨
                            </a>
                        </li>
                        {% endif %}
                    </ul>

                    <!-- Setting for executive -->
                    {% if g.user.is_executive %}

                    <p class="menu-label">
                        <span class="icon"><i class="mdi mdi-cog-outline"></i></span>
                        SETTING
                    </p>
                    <ul class="menu-list">
                        <li>
                            <a class="{% if 'setting' in request.path %}is-active{% endif %}"
                               href="{{ url_for('admin.setting') }}">
                                <span class="icon"><i class="mdi mdi-window-shutter-cog"></i></span>
                                Site Í¥ÄÎ¶¨
                            </a>
                        </li>
                    </ul>
                    {% endif %}

                </aside>
                {% endblock menus %}
            </div>
        </div>
    </div>
    <div class="column">
        {% block member %}
        <!-- ÎÇ¥Î∂ÄÏöîÏÜåÎì§Ïùò text Î™®Îëê Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨:has-text-centered -->
        <div class="tile is-ancestor">

            <div class="tile is-parent">
                <article class="tile is-child notification is-warning is-light">
                    <div class="content">
                        <p class="subtitle is-size-6 mb-5">
                            üìë Ïπ¥ÌÖåÍ≥†Î¶¨ Ïàò
                        </p>
                        <p class="title has-text-black">
                            {{category_count[0]}}
                            <span class="is-size-6">
                                {% if category_count[1] > 0 %}
                                <span class="has-text-success-dark">
                                            {{category_count[1] }}%
                                            <i class="mdi mdi-trending-up"></i>
                                </span>
                                {% elif category_count[1] == 0 %}
                                <span class="has-text-grey">
                                            {{category_count[1]}}%
                                            <i class="mdi mdi-trending-neutral"></i>
                                </span>
                                {% else %}
                                <span class="has-text-danger-dark">
                                            {{category_count[1]}}%
                                            <i class="mdi mdi-trending-down"></i>
                                </span>
                                {% endif %}
                            </span>
                        </p>
                    </div>
                </article>
            </div>

            <div class="tile is-parent">
                <article class="tile is-child notification is-info is-light">
                    <div class="content">
                        <p class="subtitle is-size-6 mb-5">
                            üßæ Post Ïàò
                        </p>
                        <p class="title has-text-black">
                            {{post_count[0]}}
                            <span class="is-size-6">
                                {% if post_count[1] > 0 %}
                                <span class="has-text-success-dark">
                                            {{post_count[1]}}%
                                            <i class="mdi mdi-trending-up"></i>
                                </span>
                                {% elif post_count[1] == 0 %}
                                <span class="has-text-grey">
                                            {{post_count[1]}}%
                                            <i class="mdi mdi-trending-neutral"></i>
                                </span>
                                {% else %}
                                <span class="has-text-danger-dark">
                                            {{post_count[1]}}%
                                            <i class="mdi mdi-trending-down"></i>
                                </span>
                                {% endif %}
                            </span>
                        </p>
                    </div>
                </article>
            </div>
            <div class="tile is-parent">
                <article class="tile is-child notification is-light">
                    <div class="content">
                        <p class="subtitle is-size-6 mb-5">
                            üì∏ Î∞∞ÎÑà Ïàò
                        </p>
                        <p class="title has-text-black">
                            {{banner_count[0]}}
                            <span class="is-size-6">
                                {% if banner_count[1] > 0 %}
                                <span class="has-text-success-dark">
                                            {{banner_count[1]}}%
                                            <i class="mdi mdi-trending-up"></i>
                                </span>
                                {% elif banner_count[1] == 0 %}
                                <span class="has-text-grey">
                                            {{banner_count[1]}}%
                                            <i class="mdi mdi-trending-neutral"></i>
                                </span>
                                {% else %}
                                <span class="has-text-danger-dark">
                                            {{banner_count[1]}}%
                                            <i class="mdi mdi-trending-down"></i>
                                </span>
                                {% endif %}
                            </span>
                        </p>
                    </div>
                </article>
            </div>


            <div class="tile is-parent">
                <article class="tile is-child notification is-danger is-light">
                    <div class="content">
                        <p class="subtitle is-size-6 mb-5">
                            üë¶ Ïú†Ï†Ä Ïàò
                        </p>
                        <p class="title has-text-black">
                            {{user_count[0]}}
                            <span class="is-size-6">
                                {% if user_count[1] > 0 %}
                                <span class="has-text-success-dark">
                                            {{user_count[1]}}%
                                            <i class="mdi mdi-trending-up"></i>
                                </span>
                                {% elif user_count[1] == 0 %}
                                <span class="has-text-grey">
                                            {{user_count[1]}}%
                                            <i class="mdi mdi-trending-neutral"></i>
                                </span>
                                {% else %}
                                <span class="has-text-danger-dark">
                                            {{user_count[1]}}%
                                            <i class="mdi mdi-trending-down"></i>
                                </span>
                                {% endif %}
                            </span>
                        </p>
                    </div>
                </article>
            </div>

            <div class="tile is-parent">
                <article class="tile is-child notification is-success is-light">
                    <div class="content">
                        <p class="subtitle is-size-6 mb-5">
                            üë®‚Äçüéì ÏßÅÏõê Ïàò
                        </p>
                        <p class="title has-text-black">
                            {{employee_count[0]}}
                            <span class="is-size-6">
                                {% if employee_count[1] > 0 %}
                                <span class="has-text-success-dark">
                                            {{employee_count[1]}}%
                                            <i class="mdi mdi-trending-up"></i>
                                </span>
                                {% elif employee_count[1] == 0 %}
                                <span class="has-text-grey">
                                            {{employee_count[1]}}%
                                            <i class="mdi mdi-trending-neutral"></i>
                                </span>
                                {% else %}
                                <span class="has-text-danger-dark">
                                            {{employee_count[1]}}%
                                            <i class="mdi mdi-trending-down"></i>
                                </span>
                                {% endif %}
                            </span>
                        </p>
                    </div>
                </article>
            </div>


        </div>

        <!-- column - 2 chart 2Í∞úÎ•º ÏúÑÌïú tile ÍπîÍ∏∞ -->
        <!-- is-ancestor > ÏïÑÎûò Í∞úÎ≥ÑÏöîÏÜåÎßàÎã§ smÏóêÏÑú Í∞ÅÍ∞Å ÎÇòÎà†ÏßÄÎäî is-parentÍπåÏßÄÎßå Íµ¨Î∂Ñ-->
        <div class="tile is-ancestor ">
            <!-- ÏÇ¨Ïù¥Ï¶àÎäî is-parentÏóêÏÑ† ÎÇòÎà†Í∞ÄÏßÄÎ©¥ ÎêòÍ≥† ÏùºÎã® Îß® ÏôºÏ™ΩÎÜàÎßå Ï£ºÎ©¥ ÎêúÎã§.-->
            <div class="tile is-parent is-5 ">
                <article class="tile is-child notification is-white"
                         style="border: 1px solid lightgray;"
                >
                    <div class="content">
                        <p class="title is-size-5">üìö Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÜµÍ≥Ñ</p>
                        <!--                        <p class="subtitle is-size-6 ml-1 my-1">Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Post Ïàò ÏßëÍ≥Ñ</p>-->
                        <div id="post_chart" class="content"
                             style="width: 100%; min-height: 250px">
                            <!-- Content -->
                            chart
                        </div>
                        <p class="title is-size-5">üîñ ÌÉúÍ∑∏ ÌÜµÍ≥Ñ</p>
                        <!--                        <p class="subtitle is-size-6 ml-1 my-1">tagÎ≥Ñ post Ïàò ÏßëÍ≥Ñ</p>-->
                        <div class="content has-text-centered"
                             style="width: 100%; min-height: 150px"
                        >
                            <!-- post Îî∏Î¶∞ Ïàò ÏÉÅÏúÑ 2Í∞ú Tag table -->
                            <table class="table is-fullwidth is-hoverable is-striped">
                                <thead>
                                <tr>
                                    <th>Îû≠ÌÇπ</th>
                                    <th>ÌÉúÍ∑∏Ïù¥Î¶Ñ</th>
                                    <th>PostÏàò</th>
                                    <th>ÎàÑÏ†ÅÏ°∞ÌöåÏàò</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for tag in tag_with_post_count %}
                                <tr>
                                    <td>
                                        <div class="tags">
                                            <span class="tag is-light">
                                              {{loop.index}}ÏúÑ
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="tags">
                                            <span class="tag is-primary is-light">
                                                {{ tag.name }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>{{ tag.count }}</td>
                                    <td>{{ tag.sum }}</td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </article>
            </div>
            <div class="tile is-parent">
                <!--  notification classÎ•º ÎπºÎ©¥ ÎÇ¥Î∂Ä tabÏùò Î∞ëÏ§ÑÏù¥ ÏÇ¨ÎùºÏßê. Í∑∏Îü¨Î©¥ Ï†ïÎ†¨Ïù¥ Íπ®Ïßê -->
                <!--                <article class="tile is-child is-white"-->
                <article class="tile is-child notification is-white"
                         style="border: 1px solid lightgray;"
                >
                    <div class="content">
                        <p class="title is-size-5">‚ú® Ïú†Ï†Ä ÌÜµÍ≥Ñ</p>
                        <!-- ÏùºÏ£ºÏùºÍ∞Ñ Ïú†Ï†Ä Ïàò -->
                        <p class="subtitle is-size-6 ml-1 my-1">ÏßÄÎÇú 7Ïùº Îì±Î°ù Ïú†Ï†Ä Ïàò</p>
                        <div id="user_count_bar_chart" class="content" style="width: 100%; min-height: 250px"
                        >
                            <!-- Content -->
                            chart
                        </div>
                        <!-- chart2 Ïú†Ï†Ä ÏÑ±Î≥ÑÎ≥Ñ Ïπ¥Ïö¥Ìä∏ -->
                        <p class="subtitle is-size-6 ml-1 my-1">ÏÑ±Î≥ÑÎ≥Ñ Ïú†Ï†Ä Ïàò</p>
                        <div id="user_sex_pie_chart" class="content"
                             style="width: 100%; min-height: 250px;"
                        >

                        </div>

                    </div>
                </article>

            </div>

        </div>

        <!-- ÎÖÑÍ∞Ñ chart 1Ï§Ñ -->
        <div class="tile is-ancestor ">
            <div class="tile is-parent">
                <article class="tile is-child notification is-white"
                         style="border: 1px solid lightgray;"
                >
                    <div class="content">
                        <p class="title is-size-5">üóì ÎÖÑÍ∞Ñ ÌÜµÍ≥Ñ</p>
                        <p class="subtitle is-size-6 ml-1 my-1">ÏõîÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Î≥ÄÌôî</p>
                        <div id="year_chart" class="content" style="width: 100%; min-height: 300px">
                            <!-- Content -->
                            chart
                        </div>
                    </div>
                </article>
            </div>
        </div>

        {% endblock member %}
    </div>
</div>
{% endblock box %}

{% block vue_script %}
<script type="text/javascript">

    // categoryÎ≥Ñ post
    let postChart = echarts.init(document.getElementById('post_chart'));

    let tab_0 = document.getElementById('user_count_bar_chart');
    let userChart1 = echarts.init(tab_0);
    let tab_1 = document.getElementById('user_sex_pie_chart');
    let userChart2 = echarts.init(tab_1);

    let yearChart = echarts.init(document.getElementById('year_chart'));

    // Ï∞®Ìä∏Î•º Î∞òÏùëÌòïÏúºÎ°ú (width:100%, min-height:300px)ÏÉÅÌÉúÏóêÏÑú
    window.onresize = function () {
        console.log("window.onresize")
        postChart.resize();
        userChart1.resize();
        userChart2.resize();
        yearChart.resize();
    };

    // pyecharts ÏÇ¨Ïö©Ïãú,optionÏùÑ backendÏóêÏÑú Î∞õÏùÄ Í≤ÉÏùÑ |safeÎ°ú
    //user_count_bar_options | safe
    //user_count_bar_options | safe
    // userChart1.setOption({{user_count_bar_options | safe}})
    //user_sex_pie_options | safe
    // userChart2.setOption({{user_sex_pie_options | safe}})
    //year_options | safe
    // yearChart.setOption({{year_options | safe}})


    // Specify the configuration items and data for the chart
    let postChartOption = {
        // title: {
        //     text: 'ECharts Getting Started Example'
        // },
        tooltip: {},
        legend: {
            data: ['Ïπ¥ÌÖåÍ≥†Î¶¨'] // seriesÏùò nameÍ≥º ÏùºÏπòÌï¥ÏïºÌïúÎã§
        },
        xAxis: {
            data: JSON.parse('{{post_by_category[0] | tojson}}')
        },
        yAxis: {},
        series: [
            {
                name: 'Ïπ¥ÌÖåÍ≥†Î¶¨',
                type: 'bar',
                data: JSON.parse('{{post_by_category[1] | tojson}}'),
                // barÏóê ÏÉâ ÎÑ£Í∏∞
                itemStyle: {
                    color: function (param) {
                        const color = ['#76b143', '#7d7c6a', '#0065b3', '#7d7c6a',];
                        // param.value[0] is the x-axis value
                        // param.value is data Í∞í
                        // param.dataIndex is 0Î∂ÄÌÑ∞ ÏàúÏÑú
                        // console.log(param)
                        return color[param.dataIndex % color.length]
                    }
                },
            }
        ]
    };


    // Display the chart using the configuration items and data just specified.
    postChart.setOption(postChartOption);

</script>

{% endblock vue_script %}