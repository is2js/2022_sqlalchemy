{% extends 'base.html' %}

{% block title %} {{ department.name }} {% endblock title %}

{% block hero %}{% endblock hero %}

{% block box %}
<div class="columns">
    <div class="column is-8" style="border-right:solid 1px #eee ;">
        <div class="box is-shadowless has-background-light py-3">
            <!-- [new block] 자식들이 내용다르게 돌려쓸 block -->
            {% block breadcrumb %}
            <nav class="breadcrumb is-small" aria-label="breadcrumbs">
                <ul>
                    <!-- Home만 addrule /로 직접 걸어주고 -->
                    <li><a href="/">Home</a></li>
                    <!-- 이후로는 직접 객체로 걸어주는데, [현재]면 #으로 걸고 or href주되 is-active면 클릭안되는 상태
                         .name만 / [부모]도 껴있으면 부모객체 -->
                    <li class="is-active">
                        <a href="{{ url_for('main.department', id=department.id) }}" aria-current="page">
                            {{ department.name }}</a>
                    </li>
                </ul>
            </nav>
            {% endblock breadcrumb %}
        </div>

        <!-- [new block] 자식들이 내용다르게 돌려쓸 block -->
        {% block post_box %}
        {% for post in post_list %}
        <div class="pl-2">
            <!-- [좌측정렬] 프로필 | 이름 | 시간 -->
            <div class="is-pulled-left">
                <div class="has-text-grey-light is-size-7 mt-1 is-align-items-center is-flex">
                    <figure class="image  mr-2 is-inline-block" style="border: none;">
                        <img class="is-rounded" style="height: 30px; width: 30px;"
                             src="
                                 {% if post.author.user.avatar %}
                                 {{url_for('download_file', filename=post.author.user.avatar)}}
                                 {% else %}
                                 {{url_for('static', filename='/img/user/default_avatar.svg')}}
                                 {% endif %}
                                "
                             alt="{{ g.user.username }}">
                    </figure>
                    <span class="has-text-black has-text-weight-bold">
                            {{ post.author.name }}
                        </span>
                    <span class="icon"><i class="mdi mdi-clipboard-text-clock-outline"></i></span>
                    {{ post.add_date | feed_datetime(is_feed=True, k=7) }}
                    {% if post.add_date != post.pub_date %}
                     (수정: {{ post.pub_date | feed_datetime(is_feed=True, k=7) }})
                    {% endif %}
                </div>
            </div>

            <!-- [우측정렬] 조회수 + 태그 -->
            <div class="is-pulled-right mr-2">
                <div class="has-text-grey is-size-7">
                    {% if post.tags %}
                    <span class="icon"><i class="mdi mdi-tag-heart-outline"></i></span>{{ post.tags|join(', ') }}
                    {% endif %}
                    <span class="icon"><i class="mdi mdi-eye-outline"></i></span> {{ post.view_count }}
                </div>
            </div>
            <!-- [좌우정렬 후 cleaerfix] -->
            <div class="is-clearfix"></div>

            <!-- title + desc -->
            <div class="mt-2 is-size-5 has-text-weight-bold">
                <a href="{{ url_for('main.department_post_detail', department_id=department.id, id=post.id) }}">
                    {{ post.title }}</a>
            </div>
            {% if post.desc %}
            <div class="has-text-grey is-size-7 ">설명: {{ post.desc }}</div>
            {% endif %}

            <!-- 카테고리 + 댓글 갯수 -->
            <div class="my-3 is-size-7 is-flex is-align-items-center">
                <!-- 카테고리 -->
                <a class="tag is-rounded is-size-7 is-{{post.category.icon}}"
                   href="{{ url_for('main.department_category', department_id=department.id, id=post.category.id) }}">
                    {{ post.category.name }}
                </a>
                <!-- 댓글 갯수 -->
                {% if post.comment_count > 0 %}
                <b-button class="is-rounded has-text-grey mx-2" size="is-small" style="font-size: 0.6rem"
                >
                    <span class="icon" style="width: 20px"><i class="mdi mdi-comment-outline"></i></span>
                    {{ post.comment_count }}
                </b-button>
                {% endif %}
            </div>

        </div>
        <div class=" dropdown-divider mb-3"></div>
        {% endfor %}

        {% block pagination %}
        <nav class="pagination is-small" role="navigation" aria-label="pagination">
            {% if pagination.has_prev %}
            <!-- 현재route를 걸어줘야한다 -->
            <a href="{{ url_for('main.department', id=department.id ) }}?page={{ pagination.prev_num }}"
               class="pagination-previous" title="This is the first page">Previous</a>
            {% endif %}
            {% if pagination.has_next %}
            <a href="{{ url_for('main.department', id=department.id ) }}?page={{ pagination.next_num }}"
               class="pagination-next">Next page</a>
            {% endif %}

            <ul class="pagination-list">
                {% for page in pagination.iter_pages() %}
                {% if page %}
                {% if page != pagination.page %}
                <li>
                    <a href="{{ url_for('main.department', id=department.id) }}?page={{ page }}" class="pagination-link"
                       aria-label="Page 1" aria-current="page">{{ page }}</a>
                </li>
                {% else %}
                <li>
                    <a class="pagination-link is-current" aria-label="Page 1" aria-current="page">{{ page }}</a>
                </li>
                {% endif %}
                {% else %}
                <span class=pagination-ellipsis>&hellip;</span>
                {% endif %}
                {% endfor %}
            </ul>
        </nav>
        {% endblock pagination %}

        {% endblock post_box %}
    </div>

    <!-- [new html] 자식들이 공유하는 데이터 없는 html  -->
    <div class="column">

        <!-- 검색 -->
<!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3 " >
            <h1 class="icon-text is-size-7 has-text-weight-bold">
                <span class="icon"><i class="mdi mdi-magnify"></i></span>
                {{ department.name }} 검색
            </h1>
            <div class=" dropdown-divider"></div>
            <form action="{{url_for('main.department_search', department_id=department.id)}}" method="get"
                  class="pl-2"
            >
<!--                 <b-field label="{{department.name}} 검색" label-position="on-border" >-->
                 <b-field >
                    <b-input placeholder="검색..." type="search" size="is-small"
                             value="{{word}}" name="word"
                    ></b-input>
                    <p class="control">
                        <b-button native-type="submit" class="button is-primary" size="is-small">Search</b-button>
                    </p>
                </b-field>
            </form>
        </div>

                <!-- tag  -->
<!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3" >
            <h1 class="icon-text is-size-7 has-text-weight-bold">
                <span class="icon"><i class="mdi mdi-tag-multiple-outline"></i></span>
                {{ department.name }} Category
            </h1>
            <div class=" dropdown-divider"></div>
            <div class="tags pl-2">
                {% for category in categories %}
                <a class="tag is-rounded is-size-7 is-{{category.icon}}"
                   href="{{ url_for('main.department_category', department_id=department.id, id=category.id) }}">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </div>

                <!-- Archive  -->
<!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3" >
            <h1 class="icon-text is-size-7 has-text-weight-bold">
                <span class="icon"><i class="mdi mdi-calendar-month-outline"></i></span>
                {{ department.name }} Archive
            </h1>
            <div class="dropdown-divider"></div>
            <ul>
                {% for date in dates %}
                <li class="pl-2 pt-1 is-size-7 ">
                    <span class="has-text-grey-light">•</span>
                    <a href="{{ url_for('main.department_archive', department_id=department.id, date=date) }}">
                        {{date}}
                    </a>
                </li>
<!--                <div class="dropdown-divider"></div>-->
                {% endfor %}
            </ul>
        </div>

        <!-- tag  -->
<!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3" >
            <h1 class="icon-text is-size-7 has-text-weight-bold">
                <span class="icon"><i class="mdi mdi-tag-multiple-outline"></i></span>
                {{ department.name }} Tag
            </h1>
            <div class=" dropdown-divider"></div>
            <div class="tags pl-2">
                {% for tag in tags %}
                <a class="tag is-rounded is-size-7 "
                   href="{{ url_for('main.department_tag', department_id=department.id, id=tag.id) }}">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>


        <!-- root department 전체 게시물 최근 게시글 5개   -->
<!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3" >
            <h1 class="icon-text is-size-7  has-text-weight-bold">
                <span class="icon"><i class="mdi mdi-earth"></i></span>
                월드 최신글
            </h1>
            <div class=" dropdown-divider"></div>
            <ul>
                {% for post in new_posts %}
                <li class="pl-2 is-size-7 pt-1">
<!--                    <span class="has-text-grey-light">{{ loop.index }}.</span>-->
<!--                    <span class="has-text-grey-light">-->
<!--                        • {{ post.author.upper_department.name }}|{{ post.category.name }}-->
<!--                    </span>-->
                    <span class="tag has-text-weight-bold">
                        <small>{{ post.author.upper_department.name }}</small>
                    </span>
<!--                    <span class="tag is-rounded is-{{post.category.icon}}">-->
<!--                            <small>{{ post.category.name }}</small>-->
<!--                    </span>-->
                    <a href="{{ url_for('main.department_post_detail', department_id=department.id, id=post.id) }}">
                        [{{ post.category.name }}] {{post.title}}
                    </a>
                </li>
<!--                <div class="dropdown-divider"></div>-->
                {% endfor %}
            </ul>
        </div>




    </div>
</div>
{% endblock box %}

