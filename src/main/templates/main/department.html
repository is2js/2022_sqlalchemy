{% extends 'base.html' %}

{% block title %} {{ department.name }} {% endblock title %}

{% block extra_head_style %}
<style>
    .is-bottom-bar {
        background-color: #fff;
        border-bottom: 1px solid rgba(24, 28, 33, .06);
        margin-bottom: 0.5rem;
    }

    .is-hero-background {
        background-image: url("{{url_for('static', filename='img/main/hero_background.png')}}");
        background-size: cover;
    }
</style>
{% endblock extra_head_style %}

{% block hero %}{% endblock hero %}

{% block box %}
<div class="columns">
    <div class="column is-8" style="border-right:solid 1px #eee ;">
        <div class="box is-shadowless has-background-light py-3">

            <nav class="breadcrumb is-small" aria-label="breadcrumbs">
                <div class="level">
                    <div class="level-left">
                        <div class="level-item">
                            <!-- [new block] ÏûêÏãùÎì§Ïù¥ ÎÇ¥Ïö©Îã§Î•¥Í≤å ÎèåÎ†§Ïì∏ block -->
                            {% block breadcrumb %}
                            <ul>
                                <!-- HomeÎßå addrule /Î°ú ÏßÅÏ†ë Í±∏Ïñ¥Ï£ºÍ≥† -->
                                <li><a href="/">Home</a></li>
                                <!-- Ïù¥ÌõÑÎ°úÎäî ÏßÅÏ†ë Í∞ùÏ≤¥Î°ú Í±∏Ïñ¥Ï£ºÎäîÎç∞, [ÌòÑÏû¨]Î©¥ #ÏúºÎ°ú Í±∏Í≥† or hrefÏ£ºÎêò is-activeÎ©¥ ÌÅ¥Î¶≠ÏïàÎêòÎäî ÏÉÅÌÉú
                                     .nameÎßå / [Î∂ÄÎ™®]ÎèÑ Íª¥ÏûàÏúºÎ©¥ Î∂ÄÎ™®Í∞ùÏ≤¥ -->
                                <li class="is-active">
                                    <a href="{{ url_for('main.department', id=department.id) }}" aria-current="page">
                                        {{ department.name }}</a>
                                </li>
                            </ul>
                            {% endblock breadcrumb %}
                        </div>
                    </div>
                    {% if g.user.is_upper_department(department) %}
                     
                    <div class="level-right">
                        <div class="level-item">
                            <div class="buttons is-right">
                                <!-- Î∂ÄÏÑúÍ¥ÄÎ¶¨(ÏÉÅÏúÑÎ∂ÄÏÑúÏû•) -->
                                <a href="https://justboil.me/bulma-admin-template/one/"
                                   target="_blank" class="button is-outlined is-danger is-light is-small">
                                    <span class="icon"><i class="mdi mdi-pencil-box-outline default"></i></span>
                                    <span><small>Î∂ÄÏÑúÍ¥ÄÎ¶¨</small></span>
                                </a>
                                <!-- Ï°∞ÏßÅÎèÑ(Î∂ÄÏÑúÏõê) -->
                                <a href="https://justboil.me/bulma-admin-template/one/"
                                   target="_blank" class="button is-outlined is-info is-light is-small">
                                    <span class="icon"><i class="mdi mdi-pencil-box-outline default"></i></span>
                                    <span><small>Ï°∞ÏßÅÎèÑ</small></span>
                                </a>
                                <!-- Í∏ÄÏì∞Í∏∞(Î∂ÄÏÑúÏõê) -->
                                <a href="https://justboil.me/bulma-admin-template/one/"
                                   target="_blank" class="button is-outlined is-primary is-light is-small">
                                    <span class="icon"><i class="mdi mdi-pencil-box-outline default"></i></span>
                                    <span><small>Í∏ÄÏì∞Í∏∞</small></span>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </nav>

        </div>

        <!-- [new block] ÏûêÏãùÎì§Ïù¥ ÎÇ¥Ïö©Îã§Î•¥Í≤å ÎèåÎ†§Ïì∏ block -->
        {% block post_box %}
        {% for post in post_list %}
        <div class="pl-2">
            <!-- [Ï¢åÏ∏°Ï†ïÎ†¨] ÌîÑÎ°úÌïÑ | Ïù¥Î¶Ñ | ÏãúÍ∞Ñ -->
            <div class="is-pulled-left">
                <div class="has-text-grey-light is-size-7 mt-1 is-align-items-center is-flex">
                    <figure class="image  mr-2 is-inline-block" style="border: none;">
                        <img class="is-rounded" style="height: 30px; width: 30px;"
                             src="
                                 {% if post.author.user.avatar %}
                                 {{url_for('download_file', filename=post.author.user.avatar)}}
                                 {% else %}
                                 {{url_for('static', filename='/img/user/default_avatar.svg')}}
                                 {% endif %}
                                "
                             alt="{{ g.user.username }}">
                    </figure>
                    <span class="has-text-black has-text-weight-bold">
                            {{ post.author.name }}
                        </span>
                    <span class="icon"><i class="mdi mdi-clipboard-text-clock-outline"></i></span>
                    {{ post.add_date | feed_datetime(is_feed=True, k=7) }}
                    {% if post.add_date != post.pub_date %}
                    (ÏàòÏ†ï: {{ post.pub_date | feed_datetime(is_feed=True, k=7) }})
                    {% endif %}
                </div>
            </div>

            <!-- [Ïö∞Ï∏°Ï†ïÎ†¨] Ï°∞ÌöåÏàò + ÌÉúÍ∑∏ -->
            <div class="is-pulled-right mr-2">
                <div class="has-text-grey is-size-7">
                    {% if post.tags %}
                    <span class="icon"><i class="mdi mdi-tag-heart-outline"></i></span>{{ post.tags|join(', ') }}
                    {% endif %}
                    <span class="icon"><i class="mdi mdi-eye-outline"></i></span> {{ post.view_count }}
                </div>
            </div>
            <!-- [Ï¢åÏö∞Ï†ïÎ†¨ ÌõÑ cleaerfix] -->
            <div class="is-clearfix"></div>

            <!-- title + desc -->
            <div class="mt-2 is-size-5 has-text-weight-bold">
                <a href="{{ url_for('main.department_post_detail', department_id=department.id, id=post.id) }}">
                    {{ post.title }}
                </a>
            </div>
            {% if post.desc %}
            <div class="has-text-grey is-size-7 ">ÏÑ§Î™Ö: {{ post.desc }}</div>
            {% endif %}

            <!--  Ïπ¥ÌÖåÍ≥†Î¶¨ + ÎåìÍ∏Ä Í∞ØÏàò + (ÏûêÏãùÎ∂ÄÏÑú) -->
            <div class="my-3 is-size-7 is-flex is-align-items-center">
                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ -->
                <a class="tag is-rounded is-size-7 is-{{post.category.icon}}"
                   href="{{ url_for('main.department_category', department_id=department.id, id=post.category.id) }}">
                    {{ post.category.name }}
                </a>

                <!-- ÎåìÍ∏Ä Í∞ØÏàò -->
                {% if post.comment_count > 0 %}
                <b-button class="is-rounded has-text-grey mx-2" size="is-small" style="font-size: 0.6rem"
                >
                    <span class="icon" style="width: 20px"><i class="mdi mdi-comment-outline"></i></span>
                    {{ post.comment_count }}
                </b-button>
                {% endif %}

                <!-- level 0 Î∂ÄÏÑúÏùº Í≤ΩÏö∞Îßå, ÏûëÏÑ±ÏûêÏùò ÏÉÅÏúÑÎ∂ÄÏÑú(ÏûêÏãù Î∂ÄÏÑúÏù∏ level 1 Î∂ÄÏÑú) -->
                {% if department.level == 0 %}
                <a class="tag is-rounded is-size-7 is-grey"
                   href="{{ url_for('main.department', id=post.author.upper_department.id) }}">
                    {{ post.author.upper_department.name }}
                </a>
                {% endif %}
            </div>

        </div>
        <div class=" dropdown-divider mb-3"></div>
        {% endfor %}

        {% block pagination %}
        <nav class="pagination is-small" role="navigation" aria-label="pagination">
            {% if pagination.has_prev %}
            <!-- ÌòÑÏû¨routeÎ•º Í±∏Ïñ¥Ï§òÏïºÌïúÎã§ -->
            <a href="{{ url_for('main.department', id=department.id ) }}?page={{ pagination.prev_num }}"
               class="pagination-previous" title="This is the first page">Previous</a>
            {% endif %}
            {% if pagination.has_next %}
            <a href="{{ url_for('main.department', id=department.id ) }}?page={{ pagination.next_num }}"
               class="pagination-next">Next page</a>
            {% endif %}

            <ul class="pagination-list">
                {% for page in pagination.iter_pages() %}
                {% if page %}
                {% if page != pagination.page %}
                <li>
                    <a href="{{ url_for('main.department', id=department.id) }}?page={{ page }}" class="pagination-link"
                       aria-label="Page 1" aria-current="page">{{ page }}</a>
                </li>
                {% else %}
                <li>
                    <a class="pagination-link is-current" aria-label="Page 1" aria-current="page">{{ page }}</a>
                </li>
                {% endif %}
                {% else %}
                <span class=pagination-ellipsis>&hellip;</span>
                {% endif %}
                {% endfor %}
            </ul>
        </nav>
        {% endblock pagination %}

        {% endblock post_box %}
    </div>

    <!-- [new html] ÏûêÏãùÎì§Ïù¥ Í≥µÏú†ÌïòÎäî Îç∞Ïù¥ÌÑ∞ ÏóÜÎäî html  -->
    <div class="column">
        <!-- Ìï¥ÎãπÏÉÅÏúÑÎ∂ÄÏÑú ÏßÅÏõêÏùº Í≤ΩÏö∞       -->
        {% if g.user and g.user.is_upper_department(department) %}
        <section class="hero is-hero-background is-bottom-bar">
            <div class="hero-body p-2">
                <div class="level">
                    <div class="level-left">
                        <!--                        <div class="level-item is-hero-avatar-item">-->
                        <!--                            <div class="image is-user-avatar"><img-->
                        <!--                                    src="https://avatars.dicebear.com/api/avataaars/example.svg?options[top][]=shortHair&amp;options[accessoriesChance]=93">-->
                        <!--                            </div>-->
                        <!--                        </div>-->
                        <div class="level-item is-hero-content-item">
                            <div>
                                <h3 class="title is-spaced is-size-6"> üñê Hi, <b>{{g.user.employee.name}} !!</b></h3>
                                <p class="subtitle mt-2 is-size-7 ">You have <b>6 to-dos</b> and <b>84 appointments</b>
                                </p></div>
                        </div>
                    </div>
                    <!--                    <div class="level-right">-->
                    <!--                        <div class="level-item"><a href="#/profile" class="button is-light" title="Profile"><span-->
                    <!--                                class="icon"><i-->
                    <!--                                class="mdi mdi-account default"></i></span><span>Manage profile</span></a></div>-->
                    <!--                    </div>-->
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Í≤ÄÏÉâ -->
        <!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3 ">
            <h1 class="icon-text is-size-7 has-text-weight-bold is-bottom-bar">
                <span class="icon"><i class="mdi mdi-magnify"></i></span>
                {{ department.name }} Í≤ÄÏÉâ
            </h1>
<!--            <div class=" dropdown-divider"></div>-->
            <form action="{{url_for('main.department_search', department_id=department.id)}}" method="get"
                  class="pl-2"
            >
                <!--                 <b-field label="{{department.name}} Í≤ÄÏÉâ" label-position="on-border" >-->
                <b-field>
                    <b-input placeholder="Í≤ÄÏÉâ..." type="search" size="is-small"
                             value="{{word}}" name="word"
                    ></b-input>
                    <p class="control">
                        <b-button native-type="submit" class="button is-primary" size="is-small">Search</b-button>
                    </p>
                </b-field>
            </form>
        </div>

        <!-- tag  -->
        <!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3">
            <h1 class="icon-text is-size-7 has-text-weight-bold is-bottom-bar">
                <span class="icon"><i class="mdi mdi-tag-multiple-outline"></i></span>
                {{ department.name }} Category
            </h1>
<!--            <div class=" dropdown-divider"></div>-->
            <div class="tags pl-2">
                {% for category in categories %}
                <a class="tag is-rounded is-size-7 is-{{category.icon}}"
                   href="{{ url_for('main.department_category', department_id=department.id, id=category.id) }}">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Archive  -->
        <!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3">
            <h1 class="icon-text is-size-7 has-text-weight-bold is-bottom-bar">
                <span class="icon"><i class="mdi mdi-calendar-month-outline"></i></span>
                {{ department.name }} Archive
            </h1>
<!--            <div class="dropdown-divider"></div>-->
            <ul>
                {% for date in dates %}
                <li class="pl-2 is-size-7 ">
                    <span class="has-text-grey-light">‚Ä¢</span>
                    <a href="{{ url_for('main.department_archive', department_id=department.id, date=date) }}">
                        {{date}}
                    </a>
                </li>
                <!--                <div class="dropdown-divider"></div>-->
                {% endfor %}
            </ul>
        </div>

        <!-- tag  -->
        <!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        <div class="box is-shadowless my-1 py-3">
            <h1 class="icon-text is-size-7 has-text-weight-bold is-bottom-bar">
                <span class="icon"><i class="mdi mdi-tag-multiple-outline"></i></span>
                {{ department.name }} Tag
            </h1>
<!--            <div class=" dropdown-divider"></div>-->
            <div class="tags pl-2">
                {% for tag in tags %}
                <a class="tag is-rounded is-size-7 "
                   href="{{ url_for('main.department_tag', department_id=department.id, id=tag.id) }}">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>


        <!-- root department Ï†ÑÏ≤¥ Í≤åÏãúÎ¨º ÏµúÍ∑º Í≤åÏãúÍ∏Ä 5Í∞ú   -->
        <!--        <div class="box is-shadowless" style="border:solid 1px #eee ;">-->
        {% if department.level != 0 %}
        <div class="box is-shadowless my-1 py-3">
            <h1 class="icon-text is-size-7  has-text-weight-bold is-bottom-bar">
                <span class="icon"><i class="mdi mdi-earth"></i></span>
                Ï†ÑÏ≤¥ ÏµúÏã†Í∏Ä
            </h1>
<!--            <div class=" dropdown-divider"></div>-->
            <ul>
                {% for post in new_posts %}
                <li class="pl-2 is-size-7">
                    <!--                    <span class="has-text-grey-light">{{ loop.index }}.</span>-->
                    <!--                    <span class="has-text-grey-light">-->
                    <!--                        ‚Ä¢ {{ post.author.upper_department.name }}|{{ post.category.name }}-->
                    <!--                    </span>-->
                    <span class="tag has-text-weight-bold">
                        <small>{{ post.author.upper_department.name }}</small>
                    </span>
                    <!--                    <span class="tag is-rounded is-{{post.category.icon}}">-->
                    <!--                            <small>{{ post.category.name }}</small>-->
                    <!--                    </span>-->
                    <a href="{{ url_for('main.department_post_detail', department_id=post.author.upper_department.id, id=post.id) }}">
                        [{{ post.category.name }}] {{post.title}}
                    </a>
                </li>
                <!--                <div class="dropdown-divider"></div>-->
                {% endfor %}
            </ul>
        </div>
        {% endif %}


    </div>
</div>
{% endblock box %}

